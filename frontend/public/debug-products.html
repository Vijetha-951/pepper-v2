<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Debug Products Network</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
    .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
    .test { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
    .success { background: #d4edda; border-color: #c3e6cb; }
    .error { background: #f8d7da; border-color: #f5c6cb; }
    .info { background: #d1ecf1; border-color: #b6d4ea; }
    pre { background: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto; }
    button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; }
    button:hover { background: #0056b3; }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîç Products Network Debug Tool</h1>
    <p>This tool will help diagnose the NetworkError in product management.</p>
    
    <button onclick="runDiagnostics()">Run Diagnostics</button>
    
    <div id="results"></div>
  </div>

  <script>
    const API_URL = 'http://localhost:5000/api';
    
    function log(message, type = 'info') {
      const resultsDiv = document.getElementById('results');
      const testDiv = document.createElement('div');
      testDiv.className = `test ${type}`;
      testDiv.innerHTML = message;
      resultsDiv.appendChild(testDiv);
    }
    
    async function runDiagnostics() {
      document.getElementById('results').innerHTML = '';
      log('<h3>üöÄ Starting Diagnostics...</h3>');
      
      // 1. Test server connectivity
      try {
        log('<h4>1. Testing Server Connectivity</h4>');
        const healthResponse = await fetch(`${API_URL}/health`);
        if (healthResponse.ok) {
          log('‚úÖ Server is running and accessible', 'success');
        } else {
          log(`‚ùå Server health check failed: ${healthResponse.status}`, 'error');
        }
      } catch (error) {
        log(`‚ùå Cannot connect to server: ${error.message}`, 'error');
        log('Make sure the backend server is running on port 5000', 'error');
        return;
      }
      
      // 2. Test public products endpoint
      try {
        log('<h4>2. Testing Public Products Endpoint</h4>');
        const productsResponse = await fetch(`${API_URL}/products`);
        if (productsResponse.ok) {
          const products = await productsResponse.json();
          log(`‚úÖ Public products endpoint works: ${products.length} products found`, 'success');
        } else {
          log(`‚ùå Public products failed: ${productsResponse.status}`, 'error');
        }
      } catch (error) {
        log(`‚ùå Public products error: ${error.message}`, 'error');
      }
      
      // 3. Test admin products without auth
      try {
        log('<h4>3. Testing Admin Products (No Auth)</h4>');
        const adminResponse = await fetch(`${API_URL}/admin/products`);
        if (adminResponse.status === 401) {
          log('‚úÖ Admin endpoint correctly requires authentication', 'success');
        } else {
          log(`‚ö†Ô∏è Unexpected status: ${adminResponse.status}`, 'error');
        }
      } catch (error) {
        log(`‚ùå Admin products test error: ${error.message}`, 'error');
      }
      
      // 4. Check current page for auth issues
      log('<h4>4. Authentication Check</h4>');
      if (typeof window !== 'undefined' && window.location.href.includes('admin')) {
        log('You are on an admin page. Please check:', 'info');
        log('<pre>1. Are you logged in?\\n2. Do you have admin role?\\n3. Check browser console for auth errors\\n4. Try logging out and back in</pre>');
      }
      
      // 5. CORS check
      try {
        log('<h4>5. CORS Check</h4>');
        const corsResponse = await fetch(`${API_URL}/admin/products`, { method: 'OPTIONS' });
        log(`CORS preflight status: ${corsResponse.status}`, corsResponse.status < 300 ? 'success' : 'error');
      } catch (error) {
        log(`‚ùå CORS error: ${error.message}`, 'error');
      }
      
      // 6. Solutions
      log('<h4>üîß Possible Solutions</h4>');
      log(`
        <pre><strong>If you see NetworkError:</strong>
1. Make sure you are logged in with an admin account
2. Check if user email is: vj.vijetha01@gmail.com (hardcoded admin)
3. Clear browser cache and cookies
4. Try in incognito/private mode
5. Check browser Network tab for specific error details

<strong>If authentication fails:</strong>
1. Log out and log back in
2. Make sure backend server is running: npm start in backend folder
3. Check if MongoDB is connected
4. Verify Firebase configuration

<strong>Common fixes:</strong>
- Restart the backend server
- Clear browser storage
- Check if you have admin role in Firestore
- Verify API_URL in .env file</pre>
      `, 'info');
    }
  </script>
</body>
</html>