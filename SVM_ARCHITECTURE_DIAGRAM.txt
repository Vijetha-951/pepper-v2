╔════════════════════════════════════════════════════════════════════════════════════════════════════════╗
║                    SVM CANCELLATION CLASSIFIER - SYSTEM ARCHITECTURE                                  ║
╚════════════════════════════════════════════════════════════════════════════════════════════════════════╝

┌──────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                      FRONTEND (React)                                                 │
├──────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                       │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────┐    │
│  │                         AdminCancellationSVMDashboard.jsx                                   │    │
│  ├─────────────────────────────────────────────────────────────────────────────────────────────┤    │
│  │                                                                                             │    │
│  │  Header Section                    Controls Section              Tabs Navigation            │    │
│  │  ┌──────────────────┐             ┌────────────────┐           ┌──────────────────┐       │    │
│  │  │ Dashboard Title  │             │ Refresh Button │   OR      │ Overview Tab ✓   │       │    │
│  │  │ SVM Analytics    │             │ Export CSV     │           │ Trends Tab       │       │    │
│  │  └──────────────────┘             └────────────────┘           │ Payment Tab      │       │    │
│  │                                                                  └──────────────────┘       │    │
│  │  Summary Cards (6)                 Chart Display                Table Display             │    │
│  │  ┌──────────────┐                  ┌──────────────────┐        ┌──────────────────┐      │    │
│  │  │Total Orders  │                  │ Line Chart       │        │ Order ID         │      │    │
│  │  │High Risk: 45 │  ─────────>      │ (Trends)  OR     │   ─>  │ Customer         │      │    │
│  │  │Revenue: ₹225K│                  │ Bar Chart        │        │ Amount & Risk    │      │    │
│  │  └──────────────┘                  │ (Distribution)   │        │ Level & Score    │      │    │
│  │                                     └──────────────────┘        └──────────────────┘      │    │
│  │                                                                                             │    │
│  └─────────────────────────────────────────────────────────────────────────────────────────────┘    │
│                                                                                                       │
│  ┌─ Sidebar Link ────────────────────────────────────────────────────────────────────────────────┐   │
│  │ ⚙️ Admin Panel                                                                               │   │
│  │ 📊 SVM Cancellation Analysis  <─── NEW ───                                                   │   │
│  │ 📦 Orders                                                                                    │   │
│  │ 👥 Users                                                                                     │   │
│  └────────────────────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                                       │
└──────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                          ↓ HTTP Requests ↓
                          (GET /api/cancellation/analytics, etc.)
                                          ↑ JSON Response ↑

┌──────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                              BACKEND API (Node.js/Express)                                           │
├──────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                       │
│  cancellation.routes.js                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │                                                                                               │  │
│  │  Route 1: GET /api/cancellation/analytics                                                   │  │
│  │  ├─ Fetch pending orders from MongoDB                                                       │  │
│  │  ├─ For each order: Call Python SVM Classifier                                              │  │
│  │  ├─ Process predictions (100+ orders in 30-60s)                                             │  │
│  │  ├─ Calculate statistics & trends                                                           │  │
│  │  └─ Return: { stats, predictions, trends, summary }                                         │  │
│  │                                                                                               │  │
│  │  Route 2: POST /api/cancellation/predict/:orderId                                           │  │
│  │  ├─ Fetch single order                                                                      │  │
│  │  ├─ Call Python classifier                                                                  │  │
│  │  └─ Return: { risk_level, risk_score, probability, recommendations }                        │  │
│  │                                                                                               │  │
│  │  Route 3: GET /api/cancellation/dashboard-summary                                           │  │
│  │  ├─ Quick stats calculation                                                                 │  │
│  │  ├─ Sample predictions for extrapolation                                                    │  │
│  │  └─ Return: { totalOrders, highRiskCount, totalRevenueAtRisk, ... }                        │  │
│  │                                                                                               │  │
│  │  Route 4: GET /api/cancellation/payment-analysis                                            │  │
│  │  ├─ Group orders by payment method                                                          │  │
│  │  ├─ Predict & analyze each group                                                            │  │
│  │  └─ Return: { COD: {...}, CARD: {...}, OTHER: {...} }                                      │  │
│  │                                                                                               │  │
│  └────────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                                       │
│  MongoDB Connection                              Python Integration                                 │
│  ┌──────────────────┐                           ┌──────────────────────┐                           │
│  │ Order Collection │                           │ PythonShell Module   │                           │
│  │ - _id            │────────────┐              │ - Spawn process      │                           │
│  │ - customer       │            └─────────>    │ - Send JSON data     │                           │
│  │ - amount         │                           │ - Receive result     │                           │
│  │ - paymentMethod  │                           └──────────────────────┘                           │
│  │ - status         │                                      ↓                                        │
│  │ - createdAt      │                           (Calls Python script)                              │
│  └──────────────────┘                                                                               │
│                                                                                                       │
└──────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                          ↓ Spawn Process ↓
                            (PythonShell.run() - JSON communication)
                                          ↑ Return Results ↑

┌──────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                       BACKEND ML ENGINE (Python/scikit-learn)                                        │
├──────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                       │
│  cancellation_svm_classifier.py                                                                     │
│  ┌────────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │                                                                                               │  │
│  │  Input Data                   Feature Extraction              Model Processing               │  │
│  │  ┌──────────────┐              ┌────────────────────┐        ┌────────────────────┐         │  │
│  │  │ Order Data   │              │ 8 Features:        │        │ StandardScaler     │         │  │
│  │  │ - amount     │─────>        │ 1. is_cod          │─────>  │ - Normalize        │         │  │
│  │  │ - payment    │              │ 2. cancellations   │        │   features         │         │  │
│  │  │ - createdAt  │              │ 3. order_amount    │        │                    │         │  │
│  │  │              │              │ 4. delivery_days   │        └─────┬──────────────┘         │  │
│  │  │ Customer     │              │ 5. order_count     │              │                        │  │
│  │  │ - createdAt  │              │ 6. account_age     │              ↓                        │  │
│  │  │              │              │ 7. avg_order_value │        ┌──────────────────────┐      │  │
│  │  │ Customer     │              │ 8. cancellation_rt │        │ SVM Classifier       │      │  │
│  │  │ Orders       │              │                    │        │ - Kernel: RBF        │      │  │
│  │  │ - status     │              └────────────────────┘        │ - C: 1.0             │      │  │
│  │  │ - amount     │                                            │ - Probability: True  │      │  │
│  │  └──────────────┘                                            └─────┬────────────────┘      │  │
│  │                                                                     │                        │  │
│  │                                                                     ↓                        │  │
│  │                                            Output Data                                      │  │
│  │                                        ┌──────────────────┐                                 │  │
│  │                                        │ Risk Prediction  │                                 │  │
│  │                                        │ - risk_level     │  (LOW/MEDIUM/HIGH)              │  │
│  │                                        │ - risk_score     │  (0-100)                        │  │
│  │                                        │ - probability    │  (0-1)                          │  │
│  │                                        │ - confidence     │  (0-100)                        │  │
│  │                                        │ - features       │  (extracted values)             │  │
│  │                                        │ - recommendations│  (action items)                 │  │
│  │                                        └──────────────────┘                                 │  │
│  │                                                                                               │  │
│  │  Model Storage                                                                               │  │
│  │  ┌──────────────────────────────────────────────┐                                            │  │
│  │  │ models/svm_cancellation_model.pkl            │                                            │  │
│  │  │ - Trained SVM model (binary pickle)          │                                            │  │
│  │  │ - StandardScaler fitted on training data     │                                            │  │
│  │  │ - Feature names & metadata                   │                                            │  │
│  │  └──────────────────────────────────────────────┘                                            │  │
│  │                                                                                               │  │
│  └────────────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                                       │
└──────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                          ↓ Returns ↓
                                  (JSON Result)
                                          ↑ Back to Node.js ↑

┌──────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                      DATA FLOW EXAMPLE                                               │
├──────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                       │
│  1. Admin clicks "Refresh Analytics"                                                                 │
│     └─> Frontend sends: GET /api/cancellation/analytics?limit=200                                    │
│                                                                                                       │
│  2. Backend receives request                                                                         │
│     └─> Queries MongoDB for pending orders                                                          │
│     └─> Gets 150 orders with customer info                                                          │
│                                                                                                       │
│  3. For each order, backend calls Python:                                                            │
│     ┌─────────────────────────────────────────┐                                                      │
│     │ Spawn: python cancellation_svm_classifier.py                                                   │
│     │ Send: { "order": {...}, "customer": {...}, "customer_orders": [...] }                         │
│     │ Wait: Classifier processes data                                                                │
│     │       - Extracts 8 features                                                                    │
│     │       - Scales features                                                                        │
│     │       - Runs through SVM model                                                                 │
│     │       - Calculates probability                                                                 │
│     │ Receive: { "risk_level": "HIGH", "risk_score": 85.3, ... }                                   │
│     └─────────────────────────────────────────┘                                                      │
│                                                                                                       │
│  4. Backend aggregates results (30-60s for 150 orders):                                              │
│     ├─ Count HIGH/MEDIUM/LOW risk orders                                                            │
│     ├─ Calculate statistics                                                                         │
│     ├─ Group by date for trends                                                                     │
│     ├─ Analyze by payment method                                                                    │
│     └─ Return comprehensive JSON                                                                    │
│                                                                                                       │
│  5. Frontend receives analytics data                                                                 │
│     ├─ Update summary cards                                                                         │
│     ├─ Render charts (Canvas)                                                                       │
│     ├─ Display tables                                                                               │
│     └─ Show results instantly                                                                       │
│                                                                                                       │
│  6. Admin views dashboard                                                                            │
│     ├─ Sees 45 HIGH risk orders                                                                     │
│     ├─ Revenue at risk: ₹225,000                                                                    │
│     ├─ Can filter, sort, search                                                                     │
│     ├─ Can export CSV                                                                               │
│     └─ Can view trends & payment analysis                                                           │
│                                                                                                       │
└──────────────────────────────────────────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                  RISK CALCULATION LOGIC                                              │
├──────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                       │
│  For each order:                                                                                     │
│                                                                                                       │
│  Step 1: Extract Features                                                                            │
│  ┌─────────────────────────────────────────────────────────────┐                                    │
│  │ is_cod = 1 (order.paymentMethod == 'COD')                  │                                    │
│  │ past_cancellations = 2 (count orders with status='cancelled')                                    │
│  │ order_amount = 5000 (order.totalAmount)                    │                                    │
│  │ delivery_days = 5 (estimated based on date)                │                                    │
│  │ order_count = 10 (customer's total orders)                 │                                    │
│  │ account_age_days = 90 (days since customer created)        │                                    │
│  │ avg_order_value = 4000 (total / count)                     │                                    │
│  │ cancellation_rate = 20 (2/10 * 100)                        │                                    │
│  └─────────────────────────────────────────────────────────────┘                                    │
│                                                                                                       │
│  Step 2: Scale Features (StandardScaler)                                                             │
│  ┌─────────────────────────────────────────────────────────────┐                                    │
│  │ Features normalized using mean & std from training data      │                                    │
│  │ Ensures all features have same scale (0-1 range)            │                                    │
│  └─────────────────────────────────────────────────────────────┘                                    │
│                                                                                                       │
│  Step 3: SVM Prediction                                                                              │
│  ┌─────────────────────────────────────────────────────────────┐                                    │
│  │ SVM decision function: f(features) → decision_score         │                                    │
│  │ Probability = 1 / (1 + e^(-decision_score))                 │                                    │
│  │ Risk Score = probability * 100                              │                                    │
│  └─────────────────────────────────────────────────────────────┘                                    │
│                                                                                                       │
│  Step 4: Risk Classification                                                                         │
│  ┌─────────────────────────────────────────────────────────────┐                                    │
│  │ IF risk_score >= 70 → risk_level = "HIGH" 🔴               │                                    │
│  │ ELSE IF risk_score >= 40 → risk_level = "MEDIUM" 🟡        │                                    │
│  │ ELSE → risk_level = "LOW" 🟢                                │                                    │
│  └─────────────────────────────────────────────────────────────┘                                    │
│                                                                                                       │
│  Step 5: Generate Recommendations                                                                    │
│  ┌─────────────────────────────────────────────────────────────┐                                    │
│  │ Based on risk_level and extracted features:                 │                                    │
│  │ - HIGH: Send confirmation call, offer incentive             │                                    │
│  │ - MEDIUM: Confirm delivery, monitor closely                 │                                    │
│  │ - LOW: Standard processing                                  │                                    │
│  └─────────────────────────────────────────────────────────────┘                                    │
│                                                                                                       │
└──────────────────────────────────────────────────────────────────────────────────────────────────────┘

╔════════════════════════════════════════════════════════════════════════════════════════════════════════╗
║                                         PERFORMANCE METRICS                                          ║
├════════════════════════════════════════════════════════════════════════════════════════════════════════┤
│                                                                                                        │
│  Single Prediction:        <100ms                                                                    │
│  Batch (100 orders):       30-60 seconds                                                             │
│  Batch (200 orders):       60-120 seconds                                                            │
│  Dashboard Load:           1-2 seconds                                                               │
│  Chart Rendering:          <200ms                                                                    │
│  Export CSV:               <1 second                                                                 │
│                                                                                                        │
╚════════════════════════════════════════════════════════════════════════════════════════════════════════╝

═══════════════════════════════════════════════════════════════════════════════════════════════════════════

TECHNOLOGY STACK:

Frontend:    React 18+ → AdminCancellationSVMDashboard.jsx
  ├─ State Management: useState, useEffect
  ├─ HTTP Client: apiFetch (custom hook)
  ├─ Charts: Canvas-based (LineChart, BarChart components)
  ├─ Icons: lucide-react
  └─ Styling: CSS Grid & Flexbox

Backend:     Node.js/Express → cancellation.routes.js
  ├─ Runtime: Node.js 12+
  ├─ Framework: Express.js
  ├─ Authentication: requireAuth, requireAdmin middleware
  ├─ Python Integration: PythonShell module
  ├─ Database: MongoDB (Order, User models)
  └─ Error Handling: try-catch, asyncHandler

ML Engine:   Python 3.7+ → cancellation_svm_classifier.py
  ├─ ML Library: scikit-learn
  ├─ Algorithms: SVC (SVM), StandardScaler, train_test_split
  ├─ Math: numpy for numerical operations
  ├─ Data: JSON input/output format
  ├─ Storage: pickle for model serialization
  └─ Processing: Real-time feature engineering

═══════════════════════════════════════════════════════════════════════════════════════════════════════════